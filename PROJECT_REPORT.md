# **인플루엔자 예측 모델(PatchTST) 개발 진행 보고서**

**프로젝트명**: 인플루엔자 유사질환(ILI) 발생률 예측 모델

**최종 업데이트**: 2026년 1월 29일

---

## **1. 프로젝트 개요**

본 프로젝트는 **시계열 데이터 기반의 인플루엔자 유사질환(ILI) 발생률 예측**을 목표로 하며,

딥러닝 기반 **PatchTST(Patch Time Series Transformer)** 모델을 활용하여

다변량 시계열 데이터를 효율적으로 처리하고 예측 정확도를 향상시키는 데 목적이 있다.

- **예측 대상**: 주간 인플루엔자 유사질환(ILI) 발생률
- **예측 범위**: 향후 3주
- **데이터 기간**: 2015년 ~ 2025년 (주간 데이터)
- **주요 특징**: 주기성 특징 자동 생성, CSV 기반 데이터 처리, 완전 자동화된 학습 파이프라인

---

## **2. 현재까지의 개발 진행 현황 요약**

| **구분** | **진행 상태** |
| --- | --- |
| 데이터 수집 및 병합 | ✅ 완료 |
| CSV 기반 데이터 처리 | ✅ 완료 |
| 데이터 전처리 파이프라인 | ✅ 완료 |
| CNN-PatchTST 모델 구현 | ✅ 완료 |
| 학습 파이프라인 자동화 | ✅ 완료 |
| 예측 및 시각화 자동 생성 | ✅ 완료 |
| Feature Importance 분석 | ✅ 완료 |
| 모델 성능 평가 | ✅ 완료 |

---

## **3. 데이터 구축 및 관리 현황**

### **3.1 데이터 구성**

- **데이터 소스**: CSV 파일 기반
- **주요 데이터 파일**:
    - `influenza_ili.csv`: 의사환자 분율 (ILI 발생률)
    - `vaccine.csv`: 예방접종률
    - `respiratory.csv`: 호흡기 질환 데이터
    - `weather.csv`: 기후 데이터 (온도, 습도, 강수량)
- **데이터 유형**:
    - ILI 발생률 (의사환자 분율)
    - 백신 접종률 (vaccine_rate)
    - 호흡기 감염 지수 (respiratory_index)
    - 기후 변수들 (온도, 습도, 강수량)
    - 주차 기반 주기성 변수 (week_sin, week_cos)

### **3.2 데이터 소스 및 수집 방법**

### **3.2.1 원본 데이터 파일**

| 파일명 | 설명 | 주요 컬럼 |
| --- | --- | --- |
| `influenza_ili.csv` | 의사환자 분율 | 시즌, 주차, ILI 발생률 |
| `vaccine.csv` | 예방접종률 | 시즌, 예방접종률 |
| `respiratory.csv` | 호흡기 질환 데이터 | 시즌, 주차, 호흡기 감염 지수 |
| `weather.csv` | 기후 데이터 | 연도, 주차, 온도, 습도, 강수량 |

### **3.2.2 데이터 병합 프로세스**

**MergeDATA.ipynb**를 통해 다음 과정을 수행:

1. **시즌/주차 변환**: 시즌 주차를 캘린더 주차로 자동 변환
2. **데이터 병합**: ILI, 백신, 호흡기, 기후 데이터를 시즌+주차 기준으로 병합
3. **결측치 처리**: 선형 보간 및 median 채우기
4. **주기성 특징 생성**: week_sin, week_cos 자동 생성

**병합 결과**:

- 병합된 파일: `data/processed/3_merged_influenza_vaccine_respiratory_weather.csv`
- 결측치 채운 버전: `data/processed/3_merged_influenza_vaccine_respiratory_weather_filled.csv`

---

## **4. 데이터 품질 관리 및 전처리 전략**

### **4.1 전처리 파이프라인**

| 단계 | 처리 내용 | 방법 |
| --- | --- | --- |
| 1 | CSV 데이터 로딩 | pandas를 통한 파일 읽기 (다양한 인코딩 지원) |
| 2 | 주간 → 일간 보간 | 선형 보간을 통한 일간 데이터 생성 |
| 3 | 결측치 처리 | 선형 보간 + median 채우기 |
| 4 | 주기성 특징 생성 | week_sin, week_cos (52주 주기) |
| 5 | 특징 선택 | ILI, 백신, 호흡기, 기후 변수 자동 선택 |
| 6 | 정규화 | RobustScaler (이상치에 강건) |
| 7 | 시계열 시퀀스 생성 | 12주 입력 → 3주 예측 (슬라이딩 윈도우) |

### **4.2 데이터 검증**

- **데이터 로딩 검증**: 필수 컬럼 존재 여부 확인
- **결측치 처리**: 선형 보간 및 median 채우기로 결측치 제거
- **시계열 정렬**: date 기준으로 정렬하여 시간 순서 보장

---

## **5. 모델 개발 현황**

### **5.1 PatchTST 모델 아키텍처**

- **PatchTST (Patch Time Series Transformer)**는 시계열 데이터를 패치 단위로 나누어 처리하는 하이브리드 모델입니다.

### **5.1.1 모델 구조**

| 구성 요소 | 설정값 | 설명 |
| --- | --- | --- |
| 입력 시퀀스 길이 | 12주 | 과거 12주 데이터 입력 |
| 예측 길이 | 3주 | 향후 3주 예측 |
| 패치 크기 | 4주 | 12주를 3개 패치로 분할 |
| 멀티스케일 CNN | 커널 1, 3, 5, dilation=2 | 다양한 시간 스케일 패턴 포착 |
| Transformer Encoder | 4 layers, 2 heads | 패치 간 장기 의존성 학습 |
| 임베딩 차원 | 128 | CNN 4개 분기 합산 (32×4) |
| Feed-forward 차원 | 128 | Transformer 내부 차원 |
| 드롭아웃 | 0.3 | 과적합 방지 |

### **5.1.2 모델 파이프라인**

```
입력 데이터 (12주 × 특징 수)
    ↓
패치 분할 (3개 패치 × 4주)
    ↓
멀티스케일 CNN 임베딩 (4개 분기 병렬)
    ↓
토큰 컨볼루션 믹서 (패치 간 연속성 강화)
    ↓
위치 인코딩 (시간적 위치 정보 추가)
    ↓
Transformer Encoder (4 layers, 2 heads)
    ↓
어텐션 풀링 (3개 패치 → 1개 벡터)
    ↓
예측 헤드 (MLP: 128 → 64 → 64 → 3)
    ↓
출력 (향후 3주 ILI 예측값)
```

### **5.1.3 핵심 기술**

**멀티스케일 CNN**:

- 각 패치에 대해 4개의 CNN 분기를 병렬로 적용
- Branch 1 (k=1): 즉각적인 변화 포착
- Branch 2 (k=3): 단기 패턴 (3주)
- Branch 3 (k=5): 중기 패턴 (5주)
- Branch 4 (k=3, dilation=2): 확장된 수용 영역

**Transformer Encoder**:

- 패치 간 장기 의존성 및 복잡한 관계 학습
- 예: "1월 패치"와 "12월 패치" 간의 계절성 관계

**어텐션 풀링**:

- 3개 패치 토큰을 가중 평균하여 하나의 벡터로 집약
- 중요한 패치에 더 높은 가중치 부여

### **5.2 손실 함수 및 학습 전략**

### **5.2.1 손실 함수**

- **손실 함수**: Huber Loss (delta=1.0)
    
    Huber Loss는 이상치에 강건하며 MAE와 MSE의 장점을 결합한 손실 함수입니다.
    
- **평가 지표**: MAE, MSE, RMSE, 상관계수
    - 상관계수는 검증 세트에서 모니터링되지만 손실 함수에는 포함되지 않습니다.

### **5.2.2 학습 설정**

| 하이퍼파라미터 | 값 | 설명 |
| --- | --- | --- |
| Epochs | 100 | 최대 학습 에포크 |
| Batch Size | 64 | 배치 크기 |
| Learning Rate | 5e-4 | 학습률 |
| Weight Decay | 5e-4 | L2 정규화 |
| Patience | 60 | Early stopping patience |
| Warmup Epochs | 30 | 학습률 워밍업 기간 |
| Scheduler | CosineAnnealingLR | 코사인 어닐링 학습률 스케줄러 |

### **5.2.3 학습 자동화**

- **자동화 프로세스**:
1. 데이터 로딩 및 전처리
2. Train/Val/Test 분할 (70%/15%/15%)
3. 모델 학습 (Early stopping 포함)
4. 성능 평가 (MAE, MSE, RMSE)
5. Feature Importance 계산
6. 시각화 생성 및 저장
7. 예측 결과 CSV 저장
8. **자동 종료** (수동 개입 불필요)

### **5.3 학습 자동화**

- **자동화된 프로세스**: `train_and_eval()` 함수를 통해 전체 파이프라인 자동 실행
- **재현성 보장**: 시드 고정 (seed=42)으로 동일한 결과 보장

---

## **6. 모델 성능 평가 및 비교**

### **6.1 PatchTST 성능 지표**

| 지표 | 값 | 설명 |
| --- | --- | --- |
| **Test MAE** | **3.44** | 테스트 세트 평균 절대 오차 |
| Test MSE | 52.41 | 테스트 세트 평균 제곱 오차 |
| Test RMSE | 7.24 | 테스트 세트 평균 제곱근 오차 |

*성능 지표는 실제 실행 결과입니다.*

### **6.2 Feature Importance 분석**

**Perturbation-Based Feature Importance**

방법 사용:

- 각 특징을 섞어서(permutation) 예측 성능이 얼마나 떨어지는지 측정
- 각 특징을 평균값으로 대체하여 성능 변화 측정
- 중요도 순위는 `data/results/feature_importance.csv` 파일에 저장됨

주요 특징:
- **ili (의사환자 분율)**: 과거 ILI 값이 가장 중요한 예측 변수
- **week_sin, week_cos**: 주기성 특징이 계절성 패턴을 잘 포착
- **vaccine_rate (예방접종률)**: 백신 접종률이 발생률에 영향
- **respiratory_index**: 호흡기 감염 지수
- **기후 변수들**: 온도, 습도, 강수량 등

---

## **7. 결과 산출물 및 시각화**

### **7.1 자동 생성 파일**

모든 결과는 **수동 개입 없이 재현 가능**한 구조로 관리됨.

| 파일명 | 설명 | 저장 위치 |
| --- | --- | --- |
| ili_predictions.csv | 예측 결과 | data/results/ |
| plot_ma_curves.png | 학습 곡선 (MAE) | 프로젝트 루트 |
| plot_last_window.png | 마지막 윈도우 예측 | 프로젝트 루트 |
| plot_test_reconstruction.png | 테스트 재구성 (실제값 vs 예측값) | 프로젝트 루트 |
| feature_importance.csv | 특징 중요도 데이터 | data/results/ |
| feature_importance.png | 특징 중요도 그래프 | 프로젝트 루트 |

### **7.2 시각화 내용**

- **MAE 곡선**: 학습 및 검증 세트의 MAE 추이
- **예측 시각화**: 실제값과 예측값의 비교 그래프
- **Feature Importance**: 각 특징의 중요도 막대 그래프

---

## **8. 문서화 및 재현성**

### **8.1 문서 구성**

| 문서 | 설명 |
| --- | --- |
| README.md | 전체 프로젝트 개요 및 구조 설명 |
| PROJECT_REPORT.md | 개발 진행 보고서 (본 문서) |
| requirements.txt | Python 패키지 의존성 |

### **8.2 재현성 보장**

- **의존성 관리**: requirements.txt로 Python 패키지 관리
- **버전 고정**: 주요 패키지 버전 명시
- **자동화 스크립트**: 데이터 병합부터 모델 학습까지 자동화
- **결과 저장**: 모든 중간 결과 및 최종 결과 자동 저장
- **시드 고정**: 동일한 결과를 위한 시드 설정 (seed=42)

---

## **9. 기술 스택**

### **9.1 Python 패키지**

| 카테고리 | 패키지 | 용도 |
| --- | --- | --- |
| 데이터 처리 | pandas, numpy | 데이터 조작 및 수치 연산 |
| 딥러닝 | torch (PyTorch) | 모델 구현 및 학습 |
| 머신러닝 | scikit-learn | 전처리 및 평가 |
| 시각화 | matplotlib, seaborn | 그래프 생성 |
| Jupyter | jupyter, ipykernel | 노트북 실행 환경 |

---

## **10. 종합 평가**

본 프로젝트는

**데이터 병합 → 전처리 → 딥러닝 모델링 → 성능 검증**까지

전 과정이 체계적으로 완료된 상태이다.

특히,

- **CSV 기반 효율적 데이터 처리**: pandas를 통한 데이터 로딩 및 병합
- **주기성 특징 자동 생성**: week_sin, week_cos를 통한 계절성 패턴 포착
- **PatchTST 기반 예측 성능**: Test MAE 3.44 달성
- **완전 자동화된 파이프라인**: 수동 개입 없이 재현 가능한 구조
- **시각화 자동 생성**: 예측 결과 및 Feature Importance 자동 생성

는 실무 및 연구 모두에서 활용 가능한 수준의 완성도를 확보하였다.

### **10.1 주요 성과**

1. **모델 성능**: Test MAE 3.44 달성
2. **시스템 자동화**: 데이터 병합부터 예측까지 전 과정 자동화
3. **재현성 보장**: 시드 고정 및 의존성 관리로 완벽한 재현성 확보
4. **문서화**: 상세한 기술 문서 및 사용 가이드 제공

### **10.2 활용 가능성**

- **공공보건 정책**: 인플루엔자 유행 예측을 통한 백신 배포 계획 수립
- **의료 기관**: 병상 및 인력 배치 계획
- **연구**: 시계열 예측 모델링 방법론 연구
- **교육**: 딥러닝 기반 시계열 예측 교육 자료

---

**문서 버전**: 1.0

**최종 업데이트**: 2026년 1월 29일

**작성자**: 프로젝트 팀
